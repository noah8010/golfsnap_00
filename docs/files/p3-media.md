# P3. 미디어 선택

> **파일**: `p3-media.md`
> **최종 수정**: v1.3 (2026-02-11)

---

<!-- SECTION: P3-META -->
## 개요

| 항목 | 내용 |
|------|------|
| 목적 | 프로젝트에 사용할 미디어(영상/이미지) 선택 |
| 진입 경로 | 비율 선택(P2) → "다음" 또는 대시보드 "영상 업로드" (공유 모드) |
| 하단 네비게이션 | 숨김 |
| 흐름 위치 | 프로젝트 생성 3단계 중 **Step 2** |

### 진입 파라미터

| 파라미터 | 타입 | 필수 | 설명 |
|---------|------|------|------|
| `aspectRatio` | `AspectRatio` | O | P2에서 선택한 비율 (공유 모드: `'9:16'`) |
| `onNext` | `(media: MediaItem[], switchToEditMode?: boolean) => void` | O | 다음 단계 진행 콜백 |
| `onBack` | `() => void` | O | 뒤로가기 콜백 |
| `onClose` | `() => void` | O | 닫기 콜백 |
| `isShareMode` | `boolean` | X | 공유 모드 여부 (기본값: `false`) |

---

<!-- SECTION: P3-A -->
## A. 헤더

```
┌────────────────────────────────────┐
│ ← 미디어 선택                    ✕ │
│ [전체] [영상] [이미지]              │
└────────────────────────────────────┘
```

### 상단 행

| 요소 | 상세 |
|------|------|
| ← 뒤로가기 | ChevronLeft 아이콘 (24×24px), 원형 40×40px |
| 페이지 제목 | "미디어 선택" 고정 텍스트, 18px bold |
| ✕ 닫기 | X 아이콘 (24×24px), 원형 40×40px |

### ← 뒤로가기 동작

| 모드 | 동작 |
|------|------|
| 편집 모드 | P2(비율 선택)로 복귀 |
| 공유 모드 | 대시보드(P1)로 복귀 (플로우 종료) |

### ✕ 닫기 동작

| 항목 | 규칙 |
|------|------|
| 탭 동작 | 대시보드(P1)로 복귀 |
| 상태 초기화 | 선택 상태 모두 초기화 (플로우 재시작) |

---

<!-- SECTION: P3-FILTER -->
## 필터 탭

| 탭 | 필터 | 동작 |
|----|------|------|
| 전체 | 타입 필터 없음 | 모든 미디어 표시 |
| 영상 | `type === 'video'` | 영상만 표시 |
| 이미지 | `type === 'image'` | 이미지만 표시 |

### 탭 스타일

| 상태 | 배경 | 텍스트 |
|------|------|--------|
| 활성 | #2D5A3D (golf-green) | 흰색, 14px medium |
| 비활성 | #F3F4F6 (gray-100) | #4B5563 (gray-600), 14px medium |

### 탭 인터랙션

| 항목 | 규칙 |
|------|------|
| 탭 전환 시 | 목록을 처음부터 다시 로딩 (페이지 1) |
| 선택 상태 | 유지됨 (다른 탭의 미디어를 선택한 상태에서 탭 전환해도 해제되지 않음) |
| 탭 피드백 | whileTap: scale 0.95 |
| API (실 구현) | `GET /api/media?sort=createdAt:desc&type={tab}&page=1&limit=30` |

---

<!-- SECTION: P3-B -->
## B. 날짜 그룹 헤더

```
┌────────────────────────────────────┐
│ 2월 9일 (일)                    4개 │
└────────────────────────────────────┘
```

### 그룹화 규칙

| 항목 | 규칙 |
|------|------|
| 기준 | `createdAt` 날짜별 |
| 정렬 | 내림차순 (최신 날짜가 위) |
| 위치 | `sticky top-0` (스크롤 시 상단 고정) |
| z-index | 10 (미디어 아이템 위에 표시) |

### 날짜 표시 형식

| 조건 | 표시 |
|------|------|
| 오늘 | "오늘" |
| 어제 | "어제" |
| 그 외 | "M월 D일 (요일)" (예: "1월 30일 (목)") |

### 미디어 수

| 항목 | 규칙 |
|------|------|
| 위치 | 헤더 우측 |
| 형식 | "{N}개" |
| 스타일 | 12px, #9CA3AF (gray-400) |

---

<!-- SECTION: P3-C -->
## C. 미디어 그리드

```
┌──────┬──────┬──────┐
│ 🟢   │      │      │
│ 0:15 │      │ ①✓   │
├──────┼──────┼──────┤
│ ②✓   │      │      │
│ 🟢   │ 2:10 │ 🟢   │
├──────┼──────┼──────┤
│ ③✓   │      │      │
│      │ 1:07 │ 🟢   │
└──────┴──────┴──────┘
```

### 그리드 레이아웃

| 항목 | 규칙 |
|------|------|
| 열 수 | 3열 (grid-cols-3) |
| 아이템 비율 | 정사각형 (aspect-square, 1:1) |
| 간격 | 0.5px (gap-0.5) |
| 썸네일 | object-cover (크롭하여 채움) |

### 미디어 아이템 구성 요소

#### 1. 썸네일 이미지

| 항목 | 규칙 |
|------|------|
| 크기 | 전체 영역 (w-full h-full) |
| 맞춤 | object-cover |
| 비선택 시 | opacity 100% |
| 선택 시 | opacity 60% (어두워짐) |

#### 2. 메타데이터 마크 (🟢)

| 항목 | 규칙 |
|------|------|
| 표시 조건 | `hasMetadata === true` |
| 위치 | 좌측 하단 (bottom-1.5 left-1.5) |
| 크기 | 20×20px (w-5 h-5) |
| 배경 | #2D5A3D (golf-green), 원형 |
| 아이콘 | Info 아이콘 (12×12px), 흰색 |
| 의미 | 스크린골프 샷 분석 데이터 포함 |

#### 3. 영상 길이 뱃지

| 항목 | 규칙 |
|------|------|
| 표시 조건 | `type === 'video' && duration > 0` |
| 위치 | 우측 하단 (bottom-1.5 right-1.5) |
| 배경 | rgba(0,0,0,0.7) (반투명 검정) |
| 아이콘 | Play 아이콘 (10×10px), filled |
| 텍스트 | "M:SS" 형식, 12px 흰색 |
| 포맷 | `{Math.floor(seconds/60)}:{(seconds%60).padStart(2,'0')}` |

#### 4. 선택 오버레이 (선택 시)

| 항목 | 규칙 |
|------|------|
| 표시 조건 | 해당 아이템 선택됨 |
| 배경 | #3B82F6/30% (파란색 반투명) |
| 테두리 | 2px solid #3B82F6 |
| 애니메이션 | opacity 0 → 1 (Framer Motion) |

#### 5. 선택 순서 번호 (선택 시)

| 항목 | 규칙 |
|------|------|
| 위치 | 우측 상단 (top-1.5 right-1.5) |
| 크기 | 24×24px (w-6 h-6), 원형 |
| 배경 | #3B82F6 (blue-500) |
| 텍스트 | 1-based 순서 번호, 12px bold 흰색 |
| 애니메이션 | scale 0 → 1 |

#### 6. 선택 체크마크 (선택 시)

| 항목 | 규칙 |
|------|------|
| 위치 | 좌측 상단 (top-1.5 left-1.5) |
| 크기 | 20×20px (w-5 h-5), 원형 |
| 배경 | #3B82F6 (blue-500) |
| 아이콘 | Check 아이콘 (12×12px), 흰색, strokeWidth 3 |
| 애니메이션 | scale 0 → 1 |

---

<!-- SECTION: P3-SELECTION -->
## 미디어 선택 규칙

### 기본 선택 동작

| 규칙 | 상세 |
|------|------|
| 선택 방식 | 탭하여 토글 (선택 ↔ 해제) |
| 다중 선택 | 가능 |
| 순서 유지 | 선택한 순서가 타임라인 배치 순서 |
| 탭 피드백 | whileTap: scale 0.95 |

### 선택 제한

| 항목 | 규칙 |
|------|------|
| 최소 선택 | 1개 이상 선택해야 하단 버튼 활성 |
| 최대 선택 | 20개 초과 시 "최대 20개까지 선택할 수 있습니다" (warning 토스트) |

### 선택 순서 번호

| 항목 | 규칙 |
|------|------|
| 표시 | 우측 상단에 선택 순서 번호 (1, 2, 3...) |
| 해제 시 재정렬 | 중간 항목 해제 시 뒤 번호가 당겨짐 (예: 1,2,3 중 2번 해제 → 1,2) |
| 탭 전환 시 | 선택 상태 유지 (다른 탭으로 이동해도 해제 안 됨) |

---

<!-- SECTION: P3-D -->
## D. 하단 영역

```
┌────────────────────────────────────┐
│ 🟢 스윙 분석 데이터 포함           │  범례
├────────────────────────────────────┤
│ 3개 선택됨         화면 비율: 9:16 │  선택 정보
│  ┌──────────────────────────────┐  │
│  │         타임라인 생성          │  │  액션 버튼
│  └──────────────────────────────┘  │
└────────────────────────────────────┘
```

### 범례

| 항목 | 규칙 |
|------|------|
| 아이콘 | 녹색(#2D5A3D) 원형 10×10px |
| 텍스트 | "스윙 분석 데이터 포함", 12px, gray-500 |

### 선택 카운트

| 상태 | 표시 |
|------|------|
| 1개 이상 선택 | "N개 선택됨" (14px, gray-600) |
| 0개 선택 | "미디어를 선택하세요" (14px, gray-600) |

### 비율 표시

| 항목 | 규칙 |
|------|------|
| 내용 | "화면 비율: {aspectRatio}" |
| 스타일 | 12px, gray-400 |

### 액션 버튼

| 속성 | 값 |
|------|-----|
| 편집 모드 텍스트 | "타임라인 생성" |
| 공유 모드 텍스트 | "다음" |
| 배경색 | #2D5A3D (golf-green) |
| 텍스트 | 흰색, 16px, semibold |
| 라운드 | 12px (rounded-xl) |
| 비활성 | 선택 0개 → opacity 40%, cursor-not-allowed, 탭 불가 |
| 탭 피드백 | whileTap: scale 0.98 |

---

<!-- SECTION: P3-MODES -->
## 두 가지 진입 모드

### 편집 모드 (기본)

```
[P1 대시보드] → [P2 비율 선택] → [P3 미디어 선택]
                                       │
                                "타임라인 생성" 탭
                                       │
                                [P4 AI 처리] → [P5 에디터]
```

| 항목 | 규칙 |
|------|------|
| ← 뒤로가기 | P2(비율 선택)로 복귀 |
| 하단 버튼 | "타임라인 생성" |
| 버튼 탭 시 | `onNext(selectedMedia)` → P4(AI 처리)로 이동 |

### 공유 모드

```
[P1 "영상 업로드"] → [P3 미디어 선택 (공유 모드, 9:16)]
                            │
                   ┌────────┴────────┐
                   │                 │
              1개 선택           2개 이상 선택
                   │                 │
              "다음" 탭          "다음" 탭
                   │                 │
            공유 다이얼로그    "편집 모드 전환?" 다이얼로그
                                 │           │
                              편집하기      취소
                                 │           │
                            P4 → P5       P3 유지
```

| 항목 | 규칙 |
|------|------|
| ← 뒤로가기 | 대시보드(P1)로 복귀 (플로우 종료) |
| 하단 버튼 | "다음" |
| 1개 선택 + "다음" | `onNext(selectedMedia)` → 공유 다이얼로그 |
| 2개+ 선택 + "다음" | 편집 모드 전환 확인 다이얼로그 표시 |

---

<!-- SECTION: P3-MODE-DIALOG -->
## 편집 모드 전환 다이얼로그

공유 모드에서 2개 이상 미디어를 선택하고 "다음"을 탭하면 표시됩니다.

```
┌────────────────────────────────────┐
│                                    │
│      편집 모드로 전환               │
│                                    │
│   여러 개의 미디어를 선택하셨습니다.  │
│   편집 모드로 전환하시겠습니까?      │
│                                    │
│   ┌──────────┐ ┌──────────┐      │
│   │   취소    │ │  편집하기  │      │
│   └──────────┘ └──────────┘      │
│                                    │
└────────────────────────────────────┘
```

| 요소 | 동작 |
|------|------|
| 배경 딤 | 반투명 검정 오버레이 |
| 제목 | "편집 모드로 전환" |
| 본문 | "여러 개의 미디어를 선택하셨습니다. 편집 모드로 전환하시겠습니까?" |
| 취소 | 다이얼로그 닫기, P3 유지, 선택 상태 유지 |
| 편집하기 | `onNext(selectedMedia, true)` → P4(AI 처리) → P5(에디터) 이동, 기본 비율 9:16 적용 |

### 다이얼로그 애니메이션

| 요소 | 애니메이션 |
|------|----------|
| 배경 딤 | opacity 0 → 1 |
| 다이얼로그 | scale 0.9, opacity 0 → scale 1, opacity 1 |

---

<!-- SECTION: P3-SUBMIT -->
## "타임라인 생성" / "다음" 탭 시 전달 데이터

P4(AI 처리)로 이동할 때 아래 데이터를 전달합니다.

| 데이터 | 타입 | 값 |
|--------|------|-----|
| `selectedMedia` | `MediaItem[]` | 선택된 미디어 목록 (선택 순서대로) |
| `switchToEditMode` | `boolean` | 공유 모드에서 편집 전환 시 `true` |

---

<!-- SECTION: P3-MEDIA-LIST -->
## 미디어 목록 로딩 (실 서비스)

### API 호출

```
GET /api/media?sort=createdAt:desc&page={n}&limit=30
```

선택적 필터: `&type=video` 또는 `&type=image`

### 무한 스크롤

| 항목 | 규칙 |
|------|------|
| 페이지 크기 | 30개씩 로드 |
| 로딩 트리거 | 스크롤이 하단 200px 이내 도달 시 다음 페이지 요청 |
| 로딩 표시 | 하단 스피너 |
| 전체 로드 완료 | "모든 미디어를 불러왔습니다" 텍스트 |

### 초기 로딩

| 상태 | UI |
|------|-----|
| 로딩 중 | 스켈레톤 UI (3열 그리드 형태) |
| 로딩 실패 | 에러 토스트 + 재시도 버튼 |

---

<!-- SECTION: P3-UPLOAD -->
## 화면 내 업로드 기능 (실 서비스)

### 업로드 버튼

| 항목 | 규칙 |
|------|------|
| 위치 | 미디어 목록 상단 |
| 동작 | 기기 파일 선택기 (복수 선택 가능, 최대 5개 동시) |

### 업로드 진행 UI

```
┌────────────────────────────────────┐
│ 📤 업로드 중... 2/3              ✕ │
│ ████████████░░░░░░░░  67%         │
└────────────────────────────────────┘
```

| 상태 | UI |
|------|-----|
| 업로드 대기 | "업로드 준비 중..." |
| 업로드 중 | "업로드 중... N/M" + 프로그레스 바 |
| 개별 파일 완료 | 목록에 즉시 추가 (낙관적 업데이트, 최상단에 표시) |
| 전체 완료 | 상태 바 자동 사라짐 + "N개 업로드 완료" (success 토스트) |
| 개별 실패 | "{파일명} 업로드 실패" (error 토스트), 나머지 계속 진행 |
| ✕ 취소 | 진행 중 업로드 중단, 이미 완료된 파일은 유지 |

### 업로드 유효성 검사

| 검사 항목 | 제한 | 실패 시 메시지 |
|----------|------|--------------|
| 파일 포맷 | MP4, MOV, WEBM, JPG, PNG, HEIC | "지원하지 않는 파일 형식입니다" (warning) |
| 파일 크기 | ≤ 500MB | "파일 크기가 너무 큽니다 (최대 500MB)" (warning) |
| 영상 길이 | ≤ 10분 | "영상 길이가 너무 깁니다 (최대 10분)" (warning) |
| 스토리지 | 5GB 한도 내 | "저장 공간이 부족합니다" (error) |
| 동시 업로드 | ≤ 5개 | "한 번에 최대 5개까지 업로드할 수 있습니다" (warning) |

---

<!-- SECTION: P3-METADATA -->
## 메타데이터 마크 의미

| 항목 | 규칙 |
|------|------|
| 마크 의미 | 스크린골프 시뮬레이터에서 기록된 **샷 분석 데이터** 포함 |
| 포함 데이터 | 클럽 종류, 스윙 스피드, 골프장 위치 등 |
| AI 어시스턴트 | 메타데이터 있는 미디어 포함 시 에디터(P5)에서 AI 어시스턴트 기능 사용 가능 |
| 마크 없는 프로젝트 | AI 어시스턴트 비활성 |

---

<!-- SECTION: P3-STATE -->
## 상태 관리

### 컴포넌트 로컬 상태

| 상태 | 타입 | 초기값 | 설명 |
|------|------|--------|------|
| `selectedTab` | `'all' \| 'video' \| 'image'` | `'all'` | 현재 활성 필터 탭 |
| `selectedMedia` | `ExtendedMediaItem[]` | `[]` | 선택된 미디어 목록 (순서 보존) |
| `showEditModeDialog` | `boolean` | `false` | 편집 모드 전환 다이얼로그 표시 여부 |

### 타입 정의

```typescript
interface MediaItem {
  id: string;
  type: 'video' | 'image';
  uri: string;
  thumbnail: string;
  duration?: number;       // 초 단위 (video만)
  width: number;
  height: number;
  hasMetadata?: boolean;
  metadata?: {
    clubType?: string;     // 클럽 종류
    swingSpeed?: number;   // 스윙 스피드
    location?: string;     // 골프장 위치
  };
}

interface ExtendedMediaItem extends MediaItem {
  createdAt: Date;         // 생성일 (날짜 그룹화용)
}
```

---

<!-- SECTION: P3-ANIMATION -->
## 애니메이션

| 요소 | 애니메이션 | 상세 |
|------|----------|------|
| ← 뒤로가기 탭 | whileTap | scale: 0.9 |
| ✕ 닫기 탭 | whileTap | scale: 0.9 |
| 필터 탭 탭 | whileTap | scale: 0.95 |
| 미디어 아이템 탭 | whileTap | scale: 0.95 |
| 선택 오버레이 | fade-in | opacity: 0 → 1 |
| 선택 순서 번호 | scale-in | scale: 0 → 1 |
| 선택 체크마크 | scale-in | scale: 0 → 1 |
| 썸네일 투명도 | transition | opacity 100% → 60% |
| 다이얼로그 배경 | fade-in | opacity: 0 → 1 |
| 다이얼로그 본체 | scale-fade | scale: 0.9 → 1, opacity: 0 → 1 |
